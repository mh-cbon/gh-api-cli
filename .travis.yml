sudo: required

services:
  - docker

language: go
go:
  - 1.8

env:
  global:
    - GH=mh-cbon/gh-api-cli
    - APP=gh-api-cli
    - EMAIL=mh-cbon@users.noreply.github.com
    - JEKYLL=pietromenna/jekyll-cayman-theme
    - MYAPP=gh-api-cli # to clean
    - MYEMAIL=mh-cbon@users.noreply.github.com # to clean
    - secure: T5vfz3hBljkgEdFdIv2bINbPo4WYc7FBdEiIOHSgnhf/Gt89yzj5GtD475j6thHIszFf83jbyoVSxl6/vu5ZvuV9RjPaaXc0Tabb9ZXGzH0T1qUstd7bJAhFNMCIhZnKwrPWsZ/3hYAXhZVogb8x8Nfy2DaYu5gRTxmTjIe4nqC9//zKWK6TuqKhyBOVHfz0YNx7CignFXP9Ax8CI+O/orcfXhNGtqMMaQadKDGFGfx1xwjJYmbv/s0mala8Q+BB+IpJjpuG85X0Snoael5NA73gwzSD3PMvTqRck6PLLhQwm4MZVB3XR/8dV4KxKurCWP31Lci8mgs1X6C7Ypk6HxFbdmlAXe60hb0+OunTfAzrmWMWUUBNQeGAU5Oj3yq3L9V1FZN6l+Vbplof2bvCALE/o5F1ztTbbH2gRFLc+/mdzTC+2QyLb63AFV0WPV0PlaOzzFoWTxbEgXAzSY3XdGbe+rebBk6lnNPMPxOdwosBXVT0epqb75leoGeAhRiq0u5zkE7mtGV85ThGDQ/H7Og83s0+4JrxU92zpoOSKZ5QHrsdPZnQ38FSDiay25611s+1OOqt8kZK6lF9Gt02yoXTIrVJ8g+Lo2BlBb9WaXM3jbMlT9J0Ej3o8bxSGCe8/u+QOemIt1RBPraTN2EuiX1gixVphDKex+dUK5wPMCg=

before_install:
  - sudo apt-get -qq update
  - mkdir -p ${GOPATH}/bin
  - cd ~
  - curl https://glide.sh/get | sh

install:
  - cd $GOPATH/src/github.com/$GH
  - glide install
  - go install

script:
  - echo "pass"

before_deploy:
  - mkdir -p build/{386,amd64}
  - GOOS=linux GOARCH=386 go build --ldflags "-X main.VERSION=${TRAVIS_TAG}" -o build/386/$APP main.go
  - GOOS=linux GOARCH=amd64 go build --ldflags "-X main.VERSION=${TRAVIS_TAG}" -o build/amd64/$APP main.go
  - curl -L https://raw.githubusercontent.com/mh-cbon/go-bin-deb/master/create-pkg.sh | GH=$GH sh -xe
  - curl -L https://raw.githubusercontent.com/mh-cbon/go-bin-rpm/master/create-pkg.sh | GH=$GH sh -xe

after_deploy:
  - wget -O - https://raw.githubusercontent.com/mh-cbon/gh-pages/master/all.sh | sh -x
  - curl -L https://raw.githubusercontent.com/mh-cbon/go-bin-deb/master/setup-repository.sh | GH=$GH EMAIL=$EMAIL sh -xe
  - curl -L https://raw.githubusercontent.com/mh-cbon/go-bin-rpm/master/setup-repository.sh | GH=$GH EMAIL=$EMAIL sh -xe

deploy:
  provider: releases
  api_key:
    secure: GpYoHE118Z5P3UmG4KTZZ5pYm/0MuFIcmXkBi19ERt32WvzBYOO8HDN91aMux0h/FUUegG5d2TeLaZzS01uYyDO6Okw3Whbpt1Xj9f7hCEh72Xrvvkl+HsnFRtQZnrI22HF7g/5dN404GGSXjFMj4yDbigJE0zxyHqyFphqIckUDACI3sdrbzJ4RP9v80dfwF0x935C+O6ciSl0J2fZBpVu83urRKYciXMOolNg1KwulsRAuM4keIQVa5q0qM258DgpM0iImXMwaCWjuQzvOif9mVfMWwi9SRQo1wv6yrEStjq5a9SxFfNX3gbCNdCSIemQkBMAbEYgWFeDASsMDiZzpXIHx62WvGkWprU+s2grsmV4r0uqGvwMCAp4zNaycw7kF0KgSdRpwOuXEUJTBTKLv/hO20oldFAzGSQMGxiy4NOTMu7hrR1o0UG9W/uRTkIYwAp4chCganaFaxLVSNXrY+39fnvDYLlgu6gQlZIiM7OxbLZywQvIY3XL774pVASTfD/u8iHktGJVEiJQi1v7TBA4/tyH5VrAt/5Yn4Jd3QT+d2xohse91Q5rAZJ4Fl/6XhDild6pSLsMasc6NUfxg8niO4xlmafv2ftQuBvOtLTurUsD+VyJEDDTsvueQMlX4AljuD7MgJHJ4ASlgjPysddWxRL5ldoVrSTaEMwg=
  file_glob: true
  file:
    - $APP-386.deb
    - $APP-amd64.deb
    - $APP-386.rpm
    - $APP-amd64.rpm
  skip_cleanup: true
  on:
    tags: true
